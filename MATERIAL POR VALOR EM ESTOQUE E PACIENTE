SELECT  AP.NR_ATENDIMENTO,
MA.CD_MATERIAL,
(
SELECT NVL(SUM (B.VL_MOVIMENTO),0)
FROM	MOVIMENTO_ESTOQUE A,
	MOVIMENTO_ESTOQUE_VALOR B
WHERE	A.CD_OPERACAO_ESTOQUE = 4
AND	A.CD_CENTRO_CUSTO = 106
AND A.NR_ATENDIMENTO = AP.NR_ATENDIMENTO
AND A.CD_MATERIAL = MA.CD_MATERIAL
AND	A.NR_MOVIMENTO_ESTOQUE = B.NR_MOVIMENTO_ESTOQUE
AND	A.DT_MESANO_REFERENCIA between inicio_dia('01/03/2023') and fim_dia('01/03/2023')
and a.cd_acao = 1 )-

(SELECT NVL(SUM(B.VL_MOVIMENTO),0) 
FROM	MOVIMENTO_ESTOQUE A,
	MOVIMENTO_ESTOQUE_VALOR B
WHERE	A.CD_OPERACAO_ESTOQUE = 4
AND	A.CD_CENTRO_CUSTO = 106

AND A.NR_ATENDIMENTO = AP.NR_ATENDIMENTO
AND A.CD_MATERIAL = MA.CD_MATERIAL
AND	A.NR_MOVIMENTO_ESTOQUE = B.NR_MOVIMENTO_ESTOQUE
AND	A.DT_MESANO_REFERENCIA between inicio_dia('01/03/2023') and fim_dia('01/03/2023')
and a.cd_acao = 2 ) AS VL_MOVIMENTO

FROM material_atend_paciente  MA,
    CONTA_PACIENTE CP,
    ATENDIMENTO_PACIENTE AP
WHERE MA.NR_INTERNO_CONTA = CP.NR_INTERNO_CONTA
AND AP.NR_ATENDIMENTO = CP.NR_ATENDIMENTO
AND MA.DT_ATENDIMENTO  between inicio_dia('01/03/2023') and fim_dia('31/03/2023')
--AND MA.CD_MATERIAL = 42688
AND MA.CD_SETOR_ATENDIMENTO = 6
GROUP BY MA.CD_MATERIAL, AP.NR_ATENDIMENTO ORDER BY MA.CD_MATERIAL
